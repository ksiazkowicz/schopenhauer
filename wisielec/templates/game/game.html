{% extends "base.html" %}
{% load static %}

{% block content %}
    <script>
        // Note that the path doesn't matter right now; any WebSocket
        // connection gets bumped over to WebSocket consumers
        socket = new WebSocket("ws://" + window.location.host + "/game/");
        socket.onmessage = function(e) {
            var bread = JSON.parse(e.data);
            if (bread.session_id == "{{ game.session_id }}") {
                document.getElementById("used_letters").innerHTML += bread.letter + ", ";
                document.getElementById("score").innerText = bread.score;
                document.getElementById("mistakes").innerText = bread.mistakes;
                document.getElementById("progress").innerText = bread.progress;

                var img_mistakes = bread.mistakes < 5 ? bread.mistakes+1 : 6;

                document.getElementById("pikczer").setAttribute("src", "{% static 'img/wis' %}0"+(img_mistakes)+".png");
            }
        }
        socket.onopen = function() {
            //socket.send("hello world");
        }
        // Call onopen directly if socket is already open
        if (socket.readyState == WebSocket.OPEN) socket.onopen();

        function test(letter) {
            socket.send(JSON.stringify({
                session_id: "{{ game.session_id }}",
                letter: letter
            }));
        }
    </script>



    <h3 id="progress">{{ game.progress }}</h3>

    <div class="pull-right">
        <img id="pikczer" src="{% static 'img/wis' %}0{{ game.mistakes|add:"1" }}.png">
    </div>
 
    <div>
        {% if game.mistakes < 5 %}
        {% for x in alphabet %}
        <a href="javascript:test('{{x}}');">{{ x }}</a>
        <!--<a href="guess?letter={{ x }}">{{ x }}</a>-->
        {% endfor %}{% else %}PRZEGRALES ZYCIE LOL{% endif %}
        <p id="used_letters">
            Wykorzystane literki: {% if game.used_characters %}{% for x in game.used_characters %}{{ x }}{% if not forloop.last %},{% endif %} {% endfor %}{% else %}nie ma{% endif %}
        </p>
    </div>
    <div>
        <label>Punkty</label> <p id="score">{{ game.score }}</p>
        <label>Błędy</label> <p id="mistakes">{{ game.mistakes }}</p>
    </div>
{% endblock %}